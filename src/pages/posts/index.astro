---
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');
const sortedPosts = posts
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog Posts</title>
  </head>
  <body class="bg-background text-foreground min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-4xl font-bold mb-8">Blog Posts</h1>

      {
        sortedPosts.length === 0 ? (
          <p class="text-muted-foreground">No posts yet.</p>
        ) : (
          <div class="space-y-6">
            {sortedPosts.map((post) => (
              <article class="border border-border rounded-lg p-6 hover:shadow-md transition-shadow">
                <a href={`/posts/${post.slug}`} class="group">
                  <h2 class="text-2xl font-semibold mb-2 group-hover:text-primary transition-colors">
                    {post.data.title}
                  </h2>
                  {post.data.description && (
                    <p class="text-muted-foreground mb-3">{post.data.description}</p>
                  )}
                  <div class="flex items-center gap-4 text-sm text-muted-foreground">
                    <time datetime={post.data.pubDate.toISOString()}>
                      {post.data.pubDate.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                      })}
                    </time>
                    {post.data.author && <span>by {post.data.author}</span>}
                  </div>
                  {post.data.tags && post.data.tags.length > 0 && (
                    <div class="flex gap-2 mt-3">
                      {post.data.tags.map((tag) => (
                        <span class="text-xs bg-secondary text-secondary-foreground px-2 py-1 rounded">
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}
                </a>
              </article>
            ))}
          </div>
        )
      }

      <div class="mt-8">
        <a href="/" class="text-primary hover:underline">‚Üê Back to home</a>
      </div>
    </div>
  </body>
</html>
